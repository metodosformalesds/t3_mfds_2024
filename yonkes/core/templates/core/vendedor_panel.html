{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Vendedor</title>
    <!-- Enlace al archivo CSS dentro de la carpeta static -->
    <link rel="stylesheet" href="{% static 'core/css/vendedor_panel.css' %}">
    <script>
        // Función para mostrar la confirmación antes de eliminar
        function confirmarEliminacion(event) {
            if (!confirm("¿Estás seguro de que deseas eliminar este producto?")) {
                event.preventDefault(); // Evita que el formulario se envíe si el usuario cancela
            }
        }

        // Función para manejar el carrusel de imágenes
        function showImage(index, productoId) {
            const images = document.querySelectorAll(`#producto-${productoId} .carousel-image`);
            images.forEach((img, i) => {
                img.style.display = i === index ? 'block' : 'none';
            });
        }

        function setupCarousel(productoId) {
            let currentIndex = 0;
            const images = document.querySelectorAll(`#producto-${productoId} .carousel-image`);
            const totalImages = images.length;

            document.querySelector(`#producto-${productoId} .arrow-left`).addEventListener('click', () => {
                currentIndex = (currentIndex - 1 + totalImages) % totalImages;
                showImage(currentIndex, productoId);
            });

            document.querySelector(`#producto-${productoId} .arrow-right`).addEventListener('click', () => {
                currentIndex = (currentIndex + 1) % totalImages;
                showImage(currentIndex, productoId);
            });

            // Mostrar la primera imagen por defecto
            showImage(currentIndex, productoId);
        }

        // Configurar los carruseles cuando la página se cargue
        window.onload = function() {
            const productos = document.querySelectorAll('.product-item');
            productos.forEach(producto => {
                const productoId = producto.getAttribute('data-id');
                setupCarousel(productoId);
            });
        };
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Panel del Vendedor</h1>
            <!-- Botón para cerrar sesión con el estilo de inicio/registro -->
            <form action="/accounts/logout/" method="POST" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="session-button">Cerrar sesión</button>
            </form>
        </div>
        <p>Bienvenido al panel del vendedor. Aquí puedes gestionar tus productos y ventas.</p>

        <!-- Botón para añadir un nuevo producto -->
        <a href="{% url 'agregar_producto' %}" class="button">Añadir Producto</a>

        <!-- Lista de productos -->
        <h2>Mis Productos</h2>
        <ul class="product-list">
            {% if productos %}
                {% for producto in productos %}
                    <li class="product-item" data-id="{{ producto.id }}">
                        <div class="image-carousel" id="producto-{{ producto.id }}">
                            {% for imagen in producto.imagenes.all %}
                                <img src="{{ imagen.imagen.url }}" alt="Imagen del Producto" class="carousel-image" style="display: none;">
                            {% endfor %}
                            <button class="carousel-arrow arrow-left">&lt;</button>
                            <button class="carousel-arrow arrow-right">&gt;</button>
                        </div>
                        <!-- Detalles del producto -->
                        <div class="product-details">
                            <h3>{{ producto.nombre }}</h3>
                            <p>Precio: ${{ producto.precio }}</p>
                            <p>Categoría: {{ producto.categoria }}</p>
                            <p>{{ producto.descripcion }}</p>
                            <div class="product-actions">
                                <!-- Botón de Editar Producto -->
                                <a href="{% url 'editar_producto' producto.pk %}" class="edit-button">Editar</a>
                                <!-- Botón de Eliminar Producto con confirmación -->
                                <form action="{% url 'eliminar_producto' producto.pk %}" method="post" style="display: inline;" onsubmit="confirmarEliminacion(event)">
                                    {% csrf_token %}
                                    <button type="submit" class="delete-button">Eliminar</button>
                                </form>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            {% else %}
                <p>No tienes productos en venta.</p>
            {% endif %}
        </ul>
    </div>
</body>
</html>
