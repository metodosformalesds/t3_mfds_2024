{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Vendedor</title>
    <link rel="stylesheet" href="{% static 'core/css/vendedor_panel.css' %}">
    <style>
        .product-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 20px;
        }
        .image-carousel {
            flex: 0 0 400px;
            height: 300px;
            margin-right: 20px;
            position: relative;
            overflow: hidden;
        }
        .carousel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
        }
        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 5px 10px;
            border-radius: 3px;
        }
        .arrow-left {
            left: 10px;
        }
        .arrow-right {
            right: 10px;
        }
        .product-details {
            flex: 1;
            display: grid;
            grid-template-columns: 150px auto;
            gap: 5px;
        }
        .product-details p {
            margin: 5px 0;
        }
        .product-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-left: 20px;
        }
        .edit-button, .delete-button {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
        }
        .edit-button {
            background-color: #004085;
        }
        .delete-button {
            background-color: #c82333;
        }
    </style>
    <script>
        function confirmarEliminacion(event) {
            if (!confirm("¿Estás seguro de que deseas eliminar este producto?")) {
                event.preventDefault();
            }
        }

        function showImage(index, productoId) {
            const images = document.querySelectorAll(`#producto-${productoId} .carousel-image`);
            images.forEach((img, i) => {
                img.style.display = i === index ? 'block' : 'none';
            });
        }

        function setupCarousel(productoId) {
            let currentIndex = 0;
            const images = document.querySelectorAll(`#producto-${productoId} .carousel-image`);
            const totalImages = images.length;
            showImage(currentIndex, productoId);

            document.querySelector(`#producto-${productoId} .arrow-left`).addEventListener('click', () => {
                currentIndex = (currentIndex - 1 + totalImages) % totalImages;
                showImage(currentIndex, productoId);
            });

            document.querySelector(`#producto-${productoId} .arrow-right`).addEventListener('click', () => {
                currentIndex = (currentIndex + 1) % totalImages;
                showImage(currentIndex, productoId);
            });

            setInterval(() => {
                currentIndex = (currentIndex + 1) % totalImages;
                showImage(currentIndex, productoId);
            }, 2000);
        }

        window.onload = function() {
            const productos = document.querySelectorAll('.product-item');
            productos.forEach(producto => {
                const productoId = producto.getAttribute('data-id');
                setupCarousel(productoId);
            });
        };
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Panel del Vendedor</h1>
            <form action="/accounts/logout/" method="POST" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="session-button">Cerrar sesión</button>
            </form>
        </div>
        <p>Bienvenido al panel del vendedor. Aquí puedes gestionar tus productos y ventas.</p>

        <a href="{% url 'agregar_producto' %}" class="button">Añadir Producto</a>

        <h2>Mis Productos</h2>
        <ul class="product-list">
            {% if productos %}
                {% for producto in productos %}
                    <li class="product-item" data-id="{{ producto.id }}">
                        <div class="image-carousel" id="producto-{{ producto.id }}">
                            {% for imagen in producto.imagenes.all %}
                                <img src="{{ imagen.imagen.url }}" alt="Imagen del Producto" class="carousel-image" style="display: none;">
                            {% endfor %}
                            <button class="carousel-arrow arrow-left">&lt;</button>
                            <button class="carousel-arrow arrow-right">&gt;</button>
                        </div>
                        <div class="product-details">
                            <p><strong>Nombre:</strong></p> <p>{{ producto.nombre }}</p>
                            <p><strong>Precio:</strong></p> <p>${{ producto.precio }}</p>
                            <p><strong>Categoría:</strong></p> <p>{{ producto.categoria }}</p>
                            <p><strong>Marca:</strong></p> <p>{{ producto.marca }}</p>
                            <p><strong>Modelo:</strong></p> <p>{{ producto.modelo }}</p>
                            <p><strong>Año:</strong></p> <p>{{ producto.año }}</p>
                            <p><strong>Motor:</strong></p> <p>{{ producto.motor }}</p>
                            <p><strong>Descripción:</strong></p> <p>{{ producto.descripcion }}</p>
                            <p><strong>Fecha de publicación:</strong></p> <p>{{ producto.time_since_created }}</p>
                        </div>
                        <div class="product-actions">
                            <a href="{% url 'editar_producto' producto.pk %}" class="edit-button">Editar</a>
                            <form action="{% url 'eliminar_producto' producto.pk %}" method="post" style="display: inline;" onsubmit="confirmarEliminacion(event)">
                                {% csrf_token %}
                                <button type="submit" class="delete-button">Eliminar</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            {% else %}
                <p>No tienes productos en venta.</p>
            {% endif %}
        </ul>
    </div>
</body>
</html>
