{% load static %}

<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horuz | Autopartes para Vehículos Usados</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        #map {
            height: 400px;
            width: 100%;
            margin-top: 20px;
        }
    </style>
    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCsvTfj2qqQYCJF-csXiW08nigzCnVWo1k&libraries=places&callback=initMap">
    </script>
</head>

<body>
    <div class="header">
        <div class="container">
            <div class="navbar">
                <div class="logo">
                    <a href="{% url 'index' %}"><img src="{% static 'images/logo.png' %}" alt="logo" width="125px"></a>
                </div>
                <nav>
                    <ul id="MenuItems">
                        <li><a href="{% url 'index' %}">Inicio</a></li>
                        <li><a href="{% url 'catalogo' %}">Productos</a></li>
                        <li>
                            {% if user.is_authenticated %}
                                <div class="dropdown">
                                    <a class="dropdown-toggle" href="#">
                                        Hola, {{ user.username }}
                                    </a>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="{% url 'account_logout' %}">Cerrar sesión</a>
                                    </div>
                                </div>
                            {% else %}
                                <a href="{% url 'account' %}">Cuenta</a>
                            {% endif %}
                        </li>
                    </ul>
                </nav>                
                <a href="{% url 'carrito' %}"><img src="{% static 'images/cart.png' %}" width="30px" height="30px"></a>
                <img src="{% static 'images/menu.png' %}" class="menu-icon" onclick="menutoggle()">
            </div>
            <div class="row">
                <div class="col-2">
                    <h1>Encuentra las Mejores Autopartes<br> para tu Vehículo Usado</h1>
                    <p>En Horuz, ofrecemos autopartes de calidad para asegurar que tu auto usado esté siempre en las mejores condiciones. Consigue todas las piezas que necesitas con confianza y al mejor precio.</p>
                    <a href="{% url 'catalogo' %}" class="btn">Ver Catálogo de Autopartes &#8594;</a>
                </div>
                <div class="col-2">
                    <img src="{% static 'images/image1.png' %}">
                </div>
            </div>
        </div>
    </div>

    <!-- Mapa de yonkes -->
    <div class="small-container">
        <h2 class="title">Yonkes en tu Ciudad Afiliados a Horuz</h2>
        <div id="map"></div>
    </div>

    <!-- Productos Destacados -->
    <div class="small-container">
        <h2 class="title">Productos Destacados</h2>
        <div class="row" id="featured-products"></div>
        <h2 class="title">Últimos Productos</h2>
        <div class="row" id="latest-products"></div>
    </div>

    <!-- Oferta Exclusiva -->
    <div class="offer">
        <div class="small-container">
            <div class="row">
                <div class="col-2">
                    <div class="offer-img-container">
                        <img src="{% static 'images/exclusive.png' %}" class="offer-img" id="exclusive-product-image">
                    </div>
                </div>
                <div class="col-2">
                    <p>Disponible Exclusivamente en Horuz</p>
                    <h1 id="exclusive-product-title">Producto Exclusivo</h1>
                    <a href="#" class="btn" id="exclusive-product-link">Comprar Ahora &#8594;</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Testimonios -->
    <div class="testimonial">
        <div class="small-container">
            <div class="row">
                <div class="col-3">
                    <i class="fa fa-quote-left"></i>
                    <p>Horuz tiene todo lo que necesito para mantener mi auto en perfecto estado. Excelente calidad y envíos rápidos.</p>
                    <div class="rating">
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                    </div>
                    <img src="{% static 'images/user-1.png' %}">
                    <h3>Carlos Gutiérrez</h3>
                </div>
                <div class="col-3">
                    <i class="fa fa-quote-left"></i>
                    <p>Muy satisfecho con el servicio de Horuz. Los repuestos llegaron a tiempo y encajaron perfectamente en mi vehículo.</p>
                    <div class="rating">
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                    </div>
                    <img src="{% static 'images/user-2.png' %}">
                    <h3>Juan Pérez</h3>
                </div>
                <div class="col-3">
                    <i class="fa fa-quote-left"></i>
                    <p>Gran variedad de autopartes y precios competitivos. Horuz se ha convertido en mi sitio de confianza para cualquier repuesto.</p>
                    <div class="rating">
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                    </div>
                    <img src="{% static 'images/user-3.png' %}">
                    <h3>Laura Fernández</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Marcas -->
    <div class="brands">
        <div class="small-container">
            <div class="row">
                <div class="col-5">
                    <img src="{% static 'images/logo-paypal.png' %}">
                </div>
                <div class="col-5">
                    <img src="{% static 'images/logo-philips.png' %}">
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="footer-col-1">
                    <h3>Descarga Nuestra App</h3>
                    <p>Descarga la app para Android y iOS.</p>
                    <div class="app-logo">
                        <img src="{% static 'images/play-store.png' %}">
                        <img src="{% static 'images/app-store.png' %}">
                    </div>
                </div>
                <div class="footer-col-2">
                    <img src="{% static 'images/logo-white.png' %}">
                    <p>Nuestro propósito es ofrecer autopartes de calidad a todos los amantes de los autos, asegurando un viaje seguro y confortable.</p>
                </div>
                <div class="footer-col-3">
                    <h3>Enlaces Útiles</h3>
                    <ul>
                        <li>Cupones</li>
                        <li>Blog</li>
                        <li>Política de Devoluciones</li>
                        <li>Programa de Afiliados</li>
                    </ul>
                </div>
                <div class="footer-col-4">
                    <h3>Síguenos</h3>
                    <ul>
                        <li>Facebook</li>
                        <li>Twitter</li>
                        <li>Instagram</li>
                        <li>Youtube</li>
                    </ul>
                </div>
            </div>
            <hr>
            <p class="copyright">Copyright 2024 - Horuz Autopartes</p>
        </div>
    </div>

    <script>
        var MenuItems = document.getElementById("MenuItems");
        MenuItems.style.maxHeight = "0px";
    
        function menutoggle() {
            if (MenuItems.style.maxHeight == "0px") {
                MenuItems.style.maxHeight = "200px";
            } else {
                MenuItems.style.maxHeight = "0px";
            }
        }
    
                let map;

        // Inicializar el mapa de Google Maps
        function initMap() {
            // Crear el mapa con un centro predeterminado
            const defaultLocation = { lat: 31.6904, lng: -106.4247 }; // Ciudad Juárez como predeterminado
            map = new google.maps.Map(document.getElementById("map"), {
                center: defaultLocation,
                zoom: 13,
            });

            // Intentar obtener la ubicación del usuario
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        // Centrar el mapa en la ubicación del usuario
                        map.setCenter(userLocation);

                        // Buscar Yonkes cercanos a la ubicación del usuario
                        buscarYonkesCercanos(userLocation);
                    },
                    () => {
                        console.error("No se pudo obtener la ubicación del usuario. Usando ubicación predeterminada.");
                        buscarYonkesCercanos(defaultLocation); // Si falla, buscar cerca de la ubicación predeterminada
                    }
                );
            } else {
                console.error("Geolocalización no soportada por el navegador.");
                buscarYonkesCercanos(defaultLocation); // Si no hay soporte, usar ubicación predeterminada
            }
        }

        // Buscar Yonkes cercanos utilizando Google Places API
        function buscarYonkesCercanos(location) {
            const service = new google.maps.places.PlacesService(map);

            const request = {
                location: location,
                radius: 20000, // Radio en metros
                keyword: "yonke", // Palabra clave para buscar yonkes
            };

            service.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    results.forEach((place) => {
                        // Crear un marcador para cada resultado
                        const marker = new google.maps.Marker({
                            position: place.geometry.location,
                            map: map,
                            title: place.name,
                        });

                        // Crear un infoWindow dinámico para mostrar los detalles del Yonke
                        const infoContent = `
                            <div style="width: 250px;">
                                <h4>${place.name}</h4>
                                <p>${place.vicinity}</p>
                                <a href="/yonke/${place.place_id}/" style="color: #ff523b; font-weight: bold;">
                                    Ver Detalles
                                </a>
                            </div>
                        `;

                        const infoWindow = new google.maps.InfoWindow({
                            content: infoContent,
                        });

                        // Mostrar infoWindow al hacer clic en el marcador
                        marker.addListener("click", () => {
                            infoWindow.open(map, marker);
                        });
                    });
                } else {
                    console.error("Error al buscar Yonkes cercanos:", status);
                }
            });
        }
    
        // Funciones para cargar y mostrar productos desde productos.json
        async function cargarProductosDesdeArchivo() {
            try {
                const response = await fetch('/static/js/productos.json'); 
                if (!response.ok) {
                    throw new Error('No se pudo cargar el archivo productos.json');
                }
                const productos = await response.json();
    
                const productosDestacados = obtenerProductosAleatorios(productos, 4);
                const ultimosProductos = obtenerProductosAleatorios(productos, 4);
    
                insertarProductosEnSeccion('featured-products', productosDestacados);
                insertarProductosEnSeccion('latest-products', ultimosProductos);
    
                const productoExclusivo = obtenerProductoAleatorio(productos);
                mostrarProductoExclusivo(productoExclusivo);
            } catch (error) {
                console.error('Error al cargar los productos desde productos.json:', error);
            }
        }
    
        function obtenerProductosAleatorios(productos, cantidad) {
            const productosAleatorios = [];
            const productosUsados = new Set();
    
            while (productosAleatorios.length < cantidad && productosAleatorios.length < productos.length) {
                const indiceAleatorio = Math.floor(Math.random() * productos.length);
                if (!productosUsados.has(indiceAleatorio)) {
                    productosAleatorios.push(productos[indiceAleatorio]);
                    productosUsados.add(indiceAleatorio);
                }
            }
            return productosAleatorios;
        }
    
        function obtenerProductoAleatorio(productos) {
            const indiceAleatorio = Math.floor(Math.random() * productos.length);
            return productos[indiceAleatorio];
        }
    
        function insertarProductosEnSeccion(idSeccion, productos) {
            const contenedor = document.getElementById(idSeccion);
            contenedor.innerHTML = '';
            productos.forEach(producto => {
                const imagen = producto.pictures && producto.pictures.length > 0 ? producto.pictures[0].url : producto.imagen;
                const productHTML = `
                    <div class="col-4">
                        <a href="/producto/${producto.id}/">
                            <img src="${imagen}" alt="${producto.titulo}" class="product-img">
                        </a>
                        <h4>${producto.titulo}</h4>
                        <div class="rating">
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star-o"></i>
                        </div>
                        <p>$${producto.precio}</p>
                    </div>
                `;
                contenedor.insertAdjacentHTML('beforeend', productHTML);
            });
        }
    
        function mostrarProductoExclusivo(producto) {
            const imagen = producto.pictures && producto.pictures.length > 0 ? producto.pictures[0].url : producto.imagen;
            document.getElementById('exclusive-product-image').src = imagen;
            document.getElementById('exclusive-product-title').innerText = producto.titulo;
            document.getElementById('exclusive-product-link').href = `/producto/${producto.id}/`;
        }
    
        // Cargar productos al cargar la página
        cargarProductosDesdeArchivo();
    </script>        
</body>

</html>
